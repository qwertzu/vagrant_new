# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant::Config.run do |config|
<% config.vms.each do |vm| %>
  config.vm.define :<%=vm.label%> do |<%= vm.name %>_config|
    <%= vm.name %>_config.vm.box = "<%= vm.base_box %>"
    <%= vm.name %>_config.vm.host_name = '<%= vm.name %>'
    <%= vm.name %>_config.vm.network :hostonly, "<%= vm.ip %>"
    <%= vm.name %>_config.vm.share_folder "vagrant", "/vagrant", "."
    <% vm.services.map(&:port_forwards).inject({}) { |hash, h| hash.merge(h) }.each_pair do |port, forward| %>
    <%= vm.name %>_config.vm.forward_port <%= port %>, <%= forward %>
    <% end %>
    <%vm.services.each do |service|%>
    <%= vm.name %>_config.vm.share_folder "<%=service.label%>" , "/vagrant/<%=service.name%>", "<%=service.code_directory%>"
    <%end%>    
  end
<% end %>
end
